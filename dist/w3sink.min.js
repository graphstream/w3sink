/*! w3sink v0.0.1 - 2014-09-26 
 *  License: MIT */

function CSS_tree(){this.nodes={},this.nodes.ids={},this.nodes.classes={},this.nodes.default={},this.edges={},this.edges.ids={},this.edges.classes={},this.edges.default={}}function data_to_obj(a){for(var b=new CSS_tree,c=new CSSParser,d=c.parse(a,!1,!0),e=0;e<d.cssRules.length;e++)for(var f=d.cssRules[e].mSelectorText,g=d.cssRules[e].declarations,h=0;h<g.length;h++){for(var i=g[h].property,j=g[h].values,k="",l=0;l<j.length;l++)k+=j[l].value+" ";k=k.substring(0,k.length-1);var m,n;"node"===f.substring(0,4)&&(f.contains("node#")?(m=f.substring(5),void 0===b.nodes.ids[m]&&(b.nodes.ids[m]={}),b.nodes.ids[m][i]=k):f.contains("node.")?(n=f.substring(5),void 0===b.nodes.classes[n]&&(b.nodes.classes[n]={}),b.nodes.classes[n][i]=k):b.nodes.default[i]=k),"edge"===f.substring(0,4)&&(f.contains("edge#")?(m=f.substring(5).toString(),void 0===b.edges.ids[m]&&(b.edges.ids[m]={}),b.edges.ids[m][i]=k):f.contains("edge.")?(n=f.substring(5),void 0===b.edges.classes[n]&&(b.edges.classes[n]={}),b.edges.classes[n][i]=k):b.edges.default[i]=k)}return b}function style_to_obj(a,b,c){var d=a+"#"+b+"{"+c+"}";return data_to_obj(d)}function update_CSS(a,b){var c=_.clone(a,!0);return _.merge(a,b),is_different(a,c)}function css_to_string(a){var b="";for(var c in a)b+=c+":"+a[c]+";";return b}function apply_css(a,b,c,d){"node"===a?graph.nodes[b].setStyle(c+":"+d):"edge"===a?graph.edges[b].setStyle(c+":"+d):console.log("Error of type: "+a+" for "+b+" in apply_css().")}function read_css_for_node(a,b,c){var d,e=a.nodes.default,f=a.nodes.classes,g=a.nodes.ids;if(c){var h=style_to_obj("node","DN",graph.default_node_style),i=style_to_obj("node","DN",css_to_string(e));update_CSS(h,i),graph.default_node_style=css_to_string(h.nodes.ids.DN)}for(d in e)apply_css("node",b,d,e[d]);for(var j in f)if(j===graph.nodes[b].className)for(d in f[j])apply_css("node",b,d,f[j][d]);for(var k in g)if(k===b)for(d in g[k])apply_css("node",b,d,g[k][d])}function read_css_for_edge(a,b,c){var d,e=a.edges.default,f=a.edges.classes,g=a.edges.ids;if(c){var h=style_to_obj("edge","DN",graph.default_edge_style),i=style_to_obj("edge","DN",css_to_string(e));update_CSS(h,i),graph.default_edge_style=css_to_string(h.edges.ids.DN)}for(d in e)apply_css("edge",b,d,e[d]);for(var j in f)if(j===graph.edges[b].className)for(d in f[j])apply_css("edge",b,d,f[j][d]);for(var k in g)if(k===b)for(d in g[k])apply_css("edge",b,d,g[k][d])}function read_css_for_obj(a,b,c){"node"===b?read_css_for_node(a,c,!0):"edge"===b?read_css_for_edge(a,c,!0):console.log("Problem of type: "+b+" in read_css_for_obj("+c+")...")}function read_nodes_css(a){var b=a.nodes.default,c=(a.nodes.classes,a.nodes.ids,style_to_obj("node","DN",graph.default_node_style)),d=style_to_obj("node","DN",css_to_string(b));update_CSS(c,d),graph.default_node_style=css_to_string(c.nodes.ids.DN);for(var e in graph.nodes)read_css_for_node(a,e,!1)}function read_edges_css(a){var b=a.edges.default,c=(a.edges.classes,a.edges.ids,style_to_obj("edge","DN",graph.default_edge_style)),d=style_to_obj("edge","DN",css_to_string(b));update_CSS(c,d),graph.default_edge_style=css_to_string(c.edges.ids.DN);for(var e in graph.edges)read_css_for_edge(a,e,!1)}function read_css(a){read_nodes_css(a),read_edges_css(a)}function is_different(a,b){return!_.isEqual(_.reduce(a),_.reduce(b))}function handle_css_content(a,b){var c=function(a){var c=data_to_obj(a),d=update_CSS(b,c);d&&read_css(b)};$.get(a).success(c)}!function(a){"use strict";function b(a,b){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}function c(a,b){var c=/(\d+)(\w+)?/,d=c.exec(b);return d[1]}function d(a){this.id=a,this.timeId=0,this.sinks=[]}function e(){}function f(a,b,c){this.id=c,this.type=b,this.graph=a,this.attributes={}}function g(a,b){f.call(this,a,"Node",b),this.edges={},this._x=0,this._y=0,this.pixelX=a.randomPixelX(),this.pixelY=a.randomPixelY(),this.index=a.indexedNodes.length,a.indexedNodes.push(this)}function h(a,b,c,d,e){f.call(this,a,"Edge",b),this.source=c,this.target=d,this.directed=e,this.points=[{x:c.pixelX,y:c.pixelY},{x:d.pixelX,y:d.pixelY}],this.index=a.indexedEdges.length,a.indexedEdges.push(this)}function i(b,c){if(d.call(this,b),"undefined"==typeof c&&(c="default"),!o.hasOwnProperty(c))throw new Error('context "'+c+'" is not registered');this.context=new o[c](b),this.nodes={},this.edges={},this.nodesCount=0,this.edgesCount=0,this.indexedNodes=[],this.indexedEdges=[],this.default_node_style="size:5; fill-color:#555;",this.default_edge_style="stroke-width:2; stroke-color:#999;",this.viewbox=new k(this),this.dispatch=new e,this._width=a.jQuery(this.context.getContainer()).width(),this._height=a.jQuery(this.context.getContainer()).height()}function j(a){this.container=document.querySelector(a)}function k(a){this.graph=a,this.minx=1/0,this.miny=1/0,this.maxx=-1/0,this.maxy=-1/0,this.padding={top:15,right:15,bottom:15,left:15}}function l(a){d.call(this,a),this.type=a}function m(a,b){o[a]=b}var n=new CSS_tree;d.prototype={addSink:function(a){this.sinks.push(a)},removeSink:function(){},newTimeId:function(){return this.timeId++},sendNodeAdded:function(a){for(var b=this.newTimeId(),c=0;c<this.sinks.length;c++)this.sinks[c].nodeAdded(this.id,b,a)},sendNodeRemoved:function(a){for(var b=this.newTimeId(),c=0;c<this.sinks.length;c++)this.sinks[c].nodeRemoved(this.id,b,a)},sendNodeAttributeAdded:function(a,b,c){for(var d=this.newTimeId(),e=0;e<this.sinks.length;e++)this.sinks[e].nodeAttributeAdded(this.id,d,a,b,c)},sendNodeAttributeChanged:function(a,b,c,d){var e=this.newTimeId();void 0===d&&(d=c);for(var f=0;f<this.sinks.length;f++)this.sinks[f].nodeAttributeChanged(this.id,e,a,b,c,d)},sendNodeAttributeRemoved:function(a,b){for(var c=this.newTimeId(),d=0;d<this.sinks.length;d++)this.sinks[d].nodeAttributeRemoved(this.id,c,a,b)},sendEdgeAdded:function(a,b,c,d){var e=this.newTimeId();void 0===d&&(d=!1);for(var f=0;f<this.sinks.length;f++)this.sinks[f].edgeAdded(this.id,e,a,b,c,d)},sendEdgeRemoved:function(a){for(var b=this.newTimeId(),c=0;c<this.sinks.length;c++)this.sinks[c].edgeRemoved(this.id,b,a)},sendEdgeAttributeAdded:function(a,b,c){for(var d=this.newTimeId(),e=0;e<this.sinks.length;e++)this.sinks[e].edgeAttributeAdded(this.id,d,a,b,c)},sendEdgeAttributeChanged:function(a,b,c,d){var e=this.newTimeId();void 0===d&&(d=c);for(var f=0;f<this.sinks.length;f++)this.sinks[f].edgeAttributeChanged(this.id,e,a,b,c,d)},sendEdgeAttributeRemoved:function(a,b){for(var c=this.newTimeId(),d=0;d<this.sinks.length;d++)this.sinks[d].edgeAttributeRemoved(this.id,c,a,b)},sendGraphAttributeAdded:function(a,b){for(var c=this.newTimeId(),d=0;d<this.sinks.length;d++)this.sinks[d].graphAttributeAdded(this.id,c,a,b)},sendGraphAttributeChanged:function(a,b,c){var d=this.newTimeId();void 0===c&&(c=b);for(var e=0;e<this.sinks.length;e++)this.sinks[e].graphAttributeChanged(this.id,d,a,b,c)},sendGraphAttributeRemoved:function(a){for(var b=this.newTimeId(),c=0;c<this.sinks.length;c++)this.sinks[c].graphAttributeRemoved(this.id,b,a)},sendGraphCleared:function(){for(var a=this.newTimeId(),b=0;b<this.sinks.length;b++)this.sinks[b].graphCleared(this.id,a)},sendStepBegins:function(a){for(var b=this.newTimeId(),c=0;c<this.sinks.length;c++)this.sinks[c].stepBegins(this.id,b,a)}},e.prototype={nodeAdded:function(){},nodeRemoved:function(){},nodeAttributeAdded:function(){},nodeAttributeChanged:function(){},nodeAttributeRemoved:function(){},edgeAdded:function(){},edgeRemoved:function(){},edgeAttributeAdded:function(){},edgeAttributeChanged:function(){},edgeAttributeRemoved:function(){},graphAttributeAdded:function(){},graphAttributeChanged:function(){},graphAttributeRemoved:function(){},graphCleared:function(){},stepBegins:function(){}},f.prototype={getAttribute:function(a){return this.attributes[a]},setAttribute:function(a,b){null===b?delete this.attributes[a]:this.attributes[a]=b},hasAttribute:function(a){return this.attributes.hasOwnProperty(a)},removeAttribute:function(a){delete this.attributes[a]},setFill:function(){},setStroke:function(){},setStrokeWidth:function(){},setSize:function(){},setShape:function(){},setLabel:function(){},setHide:function(){},setClass:function(){},setStyle:function(b){var d,e,f,g=b.split(/\s*;\s*/);for(e=0;e<g.length;e++)if(""!==g[e])switch(f=g[e].split(/\s*:\s*/),f[0]){case"fill-color":d=f[1].split(/\s*,\s*/),this.setFill(d[0]);break;case"stroke-color":d=f[1].split(/\s*,\s*/),this.setStroke(d[0]);break;case"stroke-width":this.setStrokeWidth(c(this,f[1]));break;case"z-index":this.setZIndex(f[1]);break;case"size":this.setSize(c(this,f[1]));break;case"shape":this.setShape(f[1]);break;case"fill-image":case"fill-mode":case"stroke-mode":case"padding":case"shadow-mode":case"shadow-color":case"shadow-width":case"shadow-offset":case"text-mode":case"text-background-mode":case"text-visibility-mode":case"text-visibility":case"text-color":case"text-background-color":case"text-style":case"text-alignment":case"text-padding":case"text-offset":case"text-font":case"text-size":case"icon":case"icon-mode":case"visibility":case"visibility-mode":case"size-mode":case"shape":case"arrow-shape":case"arrow-image":case"arrow-size":case"shape-points":a.console.log('[GraphStream CSS] unsupported property "'+f[0]+'" for '+this.type);break;default:a.console.log('[GraphStream CSS] unknown property "'+f[0]+'" for '+this.type)}},updateShapePosition:function(){}},g.prototype={registerEdge:function(a){this.edges[a.id]=a},unregisterEdge:function(a){delete this.edges[a.id]},x:function(a){if("undefined"==typeof a)return this._x;this._x=a;for(var b in this.edges)this.edges[b].nodePositionChanged(this)},y:function(a){if("undefined"==typeof a)return this._y;this._y=a;for(var b in this.edges)this.edges[b].nodePositionChanged(this)},z:function(a){if("undefined"==typeof a)return this._z;this._z=a;for(var b in this.edges)this.edges[b].nodePositionChanged(this)},setXY:function(a,b){this._x=a,this._y=b,this.graph.viewbox.check(a,b),this.graph.viewbox.update(this)},setXYZ:function(a,b,c){this._z=c,this.setXY(a,b)},setPixelXY:function(a,b){this.pixelX=a,this.pixelY=b,this.updateShapePosition();for(var c in this.edges)this.edges[c].nodePositionChanged();return this}},h.prototype={nodePositionChanged:function(){this.points[0].x=this.source.pixelX,this.points[0].y=this.source.pixelY,this.points[this.points.length-1].x=this.target.pixelX,this.points[this.points.length-1].y=this.target.pixelY,this.shape.geometry.verticesNeedUpdate=!0,this.updateShapePosition()}},b(f.prototype,g.prototype),b(f.prototype,h.prototype),i.prototype={width:function(){return this._width},height:function(){return this._height},an:function(b){if(this.nodes.hasOwnProperty(b))return void a.console.log('[Warning] node exists "'+b+'"');var c=this.context.createNode(this,b);this.nodes[b]=c,this.nodesCount++,c.setStyle(this.default_node_style),this.sendNodeAdded(b)},cn:function(a,b,c){var d=this.nodes[a];if(void 0===c)d.removeAttribute(b),this.sendNodeAttributeRemoved(a,b);else{if("xy"===b||"xyz"===b||"x"===b||"y"===b||"z"===b){var e,f,g;switch(b){case"x":e=c;break;case"y":f=c;break;case"z":g=c;break;case"xy":e=c[0],f=c[1];break;case"xyz":e=c[0],f=c[1],g=c[2]}d.setXYZ(e,f,g)}else if("style"===b){d.setStyle(c);var h=style_to_obj("node",d.id,c);update_CSS(n,h)}else if("size"===b)d.setSize(c);else if("label"===b)d.setLabel(c);else if("ui.class"===b)d.setClass(c),read_css_for_obj(n,"node",d.id);else if("ui.hide"===b){var i;i="true"===c?!1:!0,d.setHide(i)}else d.setAttribute(b,c);this.sendNodeAttributeChanged(a,b,c)}},setXYZ:function(a,b,c,d){var e=this.nodes[a];e.setXYZ(b,c,d)},setPixelXY:function(a,b,c){var d=this.nodes[a];d.setPixelXY(b,c)},dn:function(a){var b=[],c=this.nodes[a];for(var d in this.edges)(this.edges[d].source.id===a||this.edges[d].target.id===a)&&b.push(this.edges[d]);for(var e=0;e<b.length;e++)this.de(b[e].id);if(this.sendNodeRemoved(a),this.context.removeNode(this,c),c.index===this.indexedNodes.length-1)this.indexedNodes.pop();else{var f=this.indexedNodes[this.indexedNodes.length-1],g=f.index,h=c.index;f.index=h,this.indexedNodes[h]=f,this.indexedNodes.pop(),this.context.nodeIndexChanged(f,g,h)}delete this.nodes[a],this.nodesCount--},ae:function(b,c,d,e){if(void 0===this.nodes[c])return void a.console.log('node "'+c+'" not found for edge "'+b+'"');if(void 0===this.nodes[d])return void a.console.log('node "'+d+'" not found for edge "'+b+'"');var f=this.context.createEdge(this,b,this.nodes[c],this.nodes[d],e);this.edges[b]=f,f.setStyle(this.default_edge_style),this.nodes[c].edges[b]=f,this.nodes[d].edges[b]=f,this.edgesCount++,this.sendEdgeAdded(b,c,d,e)},ce:function(a,b,c){var d=this.edges[a];if("undefined"==typeof c)d.removeAttribute(d),this.sendEdgeAttributeRemoved(a,b);else{if("style"===b){d.setStyle(c);var e=style_to_obj("edge",d.id,c);update_CSS(n,e)}else if("size"===b)d.setSize(c);else if("label"===b)d.setLabel(c);else if("ui.class"===b)d.setClass(c),read_css_for_obj(n,"edge",d.id);else if("ui.hide"===b){var f;f="true"===c?!1:!0,d.setHide(f)}else d.setAttribute(b,c);this.sendEdgeAttributeChanged(a,b,c)}},de:function(a){var b=this.edges[a];if("undefined"!=typeof b){if(this.sendEdgeRemoved(a),this.context.removeEdge(this,b),delete b.source.edges[a],b.source!==b.target&&delete b.target.edges[a],b.index===this.indexedEdges.length-1)this.indexedEdges.pop();else{var c=this.indexedEdges[this.indexedEdges.length-1],d=c.index,e=b.index;c.index=e,this.indexedEdges[e]=c,this.indexedEdges.pop(),this.context.edgeIndexChanged(c,d,e)}delete this.edges[a],this.edgesCount--}},cg:function(){},cl:function(){this.context.clear(),this.sendGraphCleared()},st:function(a){this.sendStepBegins(a)},randomPixelX:function(a){return void 0===a&&(a=Math.random()),~~(a*this.width())},randomPixelY:function(a){return void 0===a&&(a=Math.random()),~~(a*this.height())},nodeAdded:function(a,b,c){this.an(c)},nodeRemoved:function(a,b,c){this.dn(c)},nodeAttributeAdded:function(a,b,c,d,e){this.cn(c,d,e)},nodeAttributeChanged:function(a,b,c,d,e,f){this.cn(c,d,f)},nodeAttributeRemoved:function(a,b,c,d){this.cn(c,d,null)},edgeAdded:function(a,b,c,d,e,f){this.ae(c,d,e,f)},edgeRemoved:function(a,b,c){this.de(c)},edgeAttributeAdded:function(a,b,c,d,e){this.ce(c,d,e)},edgeAttributeChanged:function(a,b,c,d,e,f){this.ce(c,d,f)},edgeAttributeRemoved:function(a,b,c,d){this.ce(c,d,null)},graphAttributeAdded:function(a,b,c,d){if("url"===d.substring(0,3)){var e=d.substring(5,d.length-2);handle_css_content(e,n)}else{var f=data_to_obj(d),g=update_CSS(n,f);g&&read_css(n)}this.cg(c,d)},graphAttributeChanged:function(a,b,c,d,e){this.cg(c,e)},graphAttributeRemoved:function(a,b,c){this.cg(c,null)},graphCleared:function(){this.cl()},stepBegins:function(a,b,c){this.st(c)}},b(d.prototype,i.prototype),j.prototype={getContainer:function(){return this.container},createNode:function(a,b){return new g(a,b)},removeNode:function(){},createEdge:function(a,b,c,d,e){return new h(a,b,c,d,e)},removeEdge:function(){},clear:function(){},zoom:function(){},nodeIndexChanged:function(){},edgeIndexChanged:function(){}},k.prototype={reset:function(){this.minx=1/0,this.miny=1/0,this.maxx=-1/0,this.maxy=-1/0},check:function(a,b){var c=!1;a<this.minx&&(c=!0,this.minx=a),b<this.miny&&(c=!0,this.miny=b),a>this.maxx&&(c=!0,this.maxx=a),b>this.maxy&&(c=!0,this.maxy=b),c&&(this.minx===this.maxx&&(this.minx-=.1,this.maxx+=.1),this.miny===this.maxy&&(this.miny-=.1,this.maxy+=.1),this.update())},compute:function(){var a,b,c,d;a=b=1/0,c=d=-1/0;for(var e in this.graph.nodes){var f=this.graph.nodes[e];a=Math.min(a,f._x),b=Math.min(b,f._y),c=Math.max(c,f._x),d=Math.max(d,f._y)}this.minx=a,this.miny=b,this.maxx=c,this.maxy=d,this.update()},update:function(a){if(void 0===a)for(var b in this.graph.nodes)this.update(this.graph.nodes[b]);else{var c=(a._x-this.minx)/(this.maxx-this.minx),d=(a._y-this.miny)/(this.maxy-this.miny);c=this.padding.left+(this.graph.width()-this.padding.left-this.padding.right)*c,d=this.padding.bottom+(this.graph.height()-this.padding.bottom-this.padding.top)*d,a.setPixelXY(c,d)}}};l.prototype={begin:function(){},nextEvents:function(){},nextStep:function(){},end:function(){}},b(d.prototype,l.prototype);var o={"default":j},p={extend:b,Node:g,Edge:h,Graph:i,Context:j,Source:d,Sink:e,FileSource:l,registerContext:m};a.GS=p}(this),function(a){"use strict";function b(){a.GS.FileSource.call(this,"json"),this.data=!1,this.lastEvent=!1}b.prototype={begin:function(b){a.jQuery.ajax({url:b,type:"GET",dataType:"json",async:!1,context:this,success:function(a){this.setData(a)},error:function(b,c,d){a.console.log(c),a.console.log(d)}})},setData:function(b){this.data=b,this.data.events.reverse(),a.console.log(this.data)},nextEvents:function(){var b,c,d,e;if(!this.data)return void a.console.log("no data");if(0===this.data.events.length)return!1;b=this.data.events.pop(),b.reverse();var f=b.pop();switch(f){case"an":this.sendNodeAdded(b.pop());break;case"cn":for(c=b.pop();b.length>0;)switch(e="",d=b.pop(),("+"===d[0]||"-"===d[0]||""===d[0])&&(e=d[0],d.splice(0,1)),e){case"":2===b.length&&b.push(b[1]),this.sendNodeAttributeChanged(c,b[0],b[1],b[2]);break;case"+":this.sendNodeAttributeAdded(c,b[0],b[1]);break;case"-":this.sendNodeAttributeRemoved(c,b[0])}break;case"dn":this.sendNodeRemoved(b.pop());break;case"ae":this.sendEdgeAdded(b.pop(),b.pop(),b.pop(),b.length>0?b.pop():!1);break;case"ce":for(c=b.pop();b.length>0;)switch(e="",d=b.pop(),("+"===d[0]||"-"===d[0]||""===d[0])&&(e=d[0],d.splice(0,1)),e){case"":2===b.length&&b.push(b[1]),this.sendEdgeAttributeChanged(c,b[0],b[1],b[2]);break;case"+":this.sendEdgeAttributeAdded(c,b[0],b[1]);break;case"-":this.sendEdgeAttributeRemoved(c,b[0])}break;case"de":this.sendEdgeRemoved(b.pop());break;case"cg":for(;b.length>0;)switch(e="",d=b.pop(),("+"===d[0]||"-"===d[0]||""===d[0])&&(e=d[0],d.splice(0,1)),e){case"":2===b.length&&b.push(b[1]),this.sendGraphAttributeChanged(b[0],b[1],b[2]);break;case"+":this.sendGraphAttributeAdded(b[0],b[1]);break;case"-":this.sendGraphAttributeRemoved(b[0])}break;case"st":this.sendStepBegins(b.pop());break;case"cl":this.sendGraphCleared();break;default:a.console.log('unknown event "'+f+'"')}return this.lastEvent=f,this.data.events.length>0},nextStep:function(){do this.nextEvents();while("st"!==this.lastEvent&&this.data.events.length>0);return this.data.events.length>0},end:function(){this.data=!1,this.lastEvent=!1}},a.GS.extend(a.GS.FileSource.prototype,b.prototype),a.GS.JSONSource=b}(this),function(a){"use strict";function b(b,c){a.GS.Node.call(this,b,c),this.shape={g:document.createElementNS(e.ns,"g"),node:document.createElementNS(e.ns,"circle"),title:document.createElementNS(e.ns,"title"),label:document.createElementNS(e.ns,"text"),labelText:document.createTextNode(""),labelStroke:document.createElementNS(e.ns,"text"),labelStrokeText:document.createTextNode("")},this.shape.g.setAttribute("transform","translate("+this.pixelX+","+this.pixelY+")"),this.shape.node.setAttribute("class","node"),this.shape.node.setAttribute("r",b.default_node_size),this.shape.node.setAttribute("cx",0),this.shape.node.setAttribute("cy",0),this.shape.node.setAttribute("fill","black"),this.shape.node.setAttribute("stroke","white"),this.shape.node.setAttribute("stroke-width","2px"),this.shape.title.textContent=c,this.shape.label.setAttribute("font-size","12px"),this.shape.label.setAttribute("fill","#ff7200"),this.shape.labelStroke.setAttribute("font-size","12px"),this.shape.labelStroke.setAttribute("fill","#ff7200"),this.shape.labelStroke.setAttribute("stroke","#222222"),this.shape.labelStroke.setAttribute("stroke-width",5),this.shape.label.appendChild(this.shape.labelText),this.shape.labelStroke.appendChild(this.shape.labelStrokeText),this.shape.g.appendChild(this.shape.node),this.shape.g.appendChild(this.shape.title),this.shape.g.appendChild(this.shape.labelStroke),this.shape.g.appendChild(this.shape.label),b.context.gnodes.appendChild(this.shape.g)}function c(b,c,d,f,g){a.GS.Edge.call(this,b,c,d,f,g),this.shape=document.createElementNS(e.ns,"line"),this.shape.setAttribute("class","edge"),this.shape.setAttribute("x1",d.pixelX),this.shape.setAttribute("y1",d.pixelY),this.shape.setAttribute("x2",f.pixelX),this.shape.setAttribute("y2",f.pixelY),this.shape.setAttribute("stroke","black"),this.shape.setAttribute("stroke-width","1px"),b.context.gedges.appendChild(this.shape)}function d(b){a.GS.Context.call(this,b),this.svg=document.createElementNS(e.ns,"svg:svg"),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%"),this.svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",e.xlinkns),this.container.appendChild(this.svg),this.root=document.createElementNS(e.ns,"g"),this.gedges=document.createElementNS(e.ns,"g"),this.gnodes=document.createElementNS(e.ns,"g"),this.root.appendChild(this.gedges),this.root.appendChild(this.gnodes),this.svg.appendChild(this.root)}var e={ns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink"};b.prototype={setFill:function(a){this.shape.node.setAttribute("fill",a)},setStroke:function(a){this.shape.node.setAttribute("stroke",a)},setStrokeWidth:function(a){this.shape.node.setAttribute("stroke-width",a)},setSize:function(a){this.shape.node.setAttribute("r",a)},setLabel:function(a){void 0===a&&(a=this.id),this.shape.labelText.textContent=a,this.shape.labelStrokeText.textContent=a},updateShapePosition:function(){this.shape.g.setAttribute("transform","translate("+this.pixelX+","+this.pixelY+")"),this.pixelX<this.graph.width()/2?(this.shape.label.setAttribute("text-anchor","start"),this.shape.labelStroke.setAttribute("text-anchor","start")):(this.shape.label.setAttribute("text-anchor","end"),this.shape.labelStroke.setAttribute("text-anchor","end"))}},c.prototype={setStroke:function(a){this.shape.setAttribute("stroke",a)},setStrokeWidth:function(a){this.shape.setAttribute("stroke-width",a)},setSize:function(a){this.setStrokeWidth(a)},updateShapePosition:function(){this.shape.setAttribute("x1",this.points[0].x),this.shape.setAttribute("y1",this.points[0].y),this.shape.setAttribute("x2",this.points[this.points.length-1].x),this.shape.setAttribute("y2",this.points[this.points.length-1].y)}},a.GS.extend(a.GS.Node.prototype,b.prototype),a.GS.extend(a.GS.Edge.prototype,c.prototype),d.prototype={createNode:function(a,c){var d=new b(a,c);return d},removeNode:function(a,b){this.gnodes.removeChild(b.shape.g)},createEdge:function(a,b,d,e,f){var g=new c(a,b,d,e,f);return g},removeEdge:function(a,b){this.gedges.removeChild(b.shape)},clear:function(){},zoom:function(a){this.svg.setAttribute("transform","scale("+a+")")}},a.GS.extend(a.GS.Context.prototype,d.prototype),a.GS.registerContext("svg",d)}(this),function(a){"use strict";function b(b,c){a.GS.Node.call(this,b,c),this.shape=new a.Kinetic.Circle({x:b.randomPixelX(),y:b.randomPixelY(),radius:15,fill:"black",stroke:"white",strokeWidth:2})}function c(b,c,d,e,f){a.GS.Edge.call(this,b,c,d,e,f),this.shape=new Kinetic.Line({points:this.points,stroke:"black",strokeWidth:2,lineJoin:"round",lineCap:"round"})}function d(a,b,c){var e,f;for(d.prototype.layers.push(this),void 0===b&&(b=4),void 0===c&&(c=b),this.stage=a,this.drag=new Kinetic.Layer("drag"),this.dragEdges=new Kinetic.Layer("dragEdges"),this.nodes=[],this.edges=[],e=0;c>e;e++)f=new Kinetic.Layer("edges#"+e),f.changed=!0,this.edges.push(f),this.stage.add(f);for(this.stage.add(this.dragEdges),e=0;b>e;e++)f=new Kinetic.Layer("nodes#"+e),f.changed=!0,this.nodes.push(f),this.stage.add(f);this.stage.add(this.drag)}function e(b){a.GS.Context.call(this,b),this.stage=new Kinetic.Stage({container:this.container,width:a.$(this.container).width(),height:a.$(this.container).height()}),this.layers=new d(this.stage)}b.prototype={updateShapePosition:function(){this.shape.setX(this.pixelX),this.shape.setY(this.pixelY),this.graph.context.layers.drawLayerOf(this)},setFill:function(a){this.shape.setFill(a)},setStroke:function(a){this.shape.setStroke(a)},setStrokeWidth:function(a){this.shape.setStrokeWidth(a)},setSize:function(a){this.shape.setRadius(a)}},a.GS.extend(a.GS.Node.prototype,b.prototype),c.prototype={updateShapePosition:function(){this.shape.setPoints(this.points),this.graph.context.layers.drawLayerOf(this)},setFill:function(a){this.shape.setFill(a)},setStroke:function(a){this.shape.setStroke(a)},setStrokeWidth:function(a){this.shape.setStrokeWidth(a)}},a.GS.extend(a.GS.Edge.prototype,c.prototype),d.prototype.layers=[],d.prototype.addNode=function(a){var b=~~(Math.random()*this.nodes.length);this.nodes[b].add(a.shape),this.nodes[b].changed=!0},d.prototype.addEdge=function(a){var b=~~(Math.random()*this.edges.length);this.edges[b].add(a.shape),this.edges[b].changed=!0},d.prototype.removeNode=function(a){var b=a.shape.getLayer();b.remove(a.shape),b.changed=!0},d.prototype.removeEdge=function(a){var b=a.shape.getLayer();b.remove(a.shape),b.changed=!0},d.prototype.drawLayerOf=function(a){a.shape.getLayer().changed=!0},d.prototype.drawAll=function(){var a;for(a=0;a<this.edges.length;a++)this.edges[a].changed&&(this.edges[a].draw(),this.edges[a].changed=!1);for(a=0;a<this.nodes.length;a++)this.nodes[a].changed&&(this.nodes[a].draw(),this.nodes[a].changed=!1)},d.prototype.dragStart=function(a){var b,c,d;for(this.__beforeDragLayer=a.shape.getLayer(),a.shape.moveTo(this.drag),a.shape.draggable(!0),b=0;b<this.nodes.length;b++)this.nodes[b].listen(!1);for(c in a.edges)d=a.edges[c].shape.getLayer(),a.edges[c].shape.moveTo(this.dragEdges),d.draw();this.__beforeDragLayer.draw(),this.drag.draw(),this.dragEdges.draw()},d.prototype.dragEnd=function(a){var b,c,d;for(a.shape.moveTo(this.__beforeDragLayer),a.shape.draggable(!1),b=0;b<this.nodes.length;b++)this.nodes[b].listen(!0);for(c in a.edges)d=~~(Math.random()*this.edges.length),a.edges[c].shape.moveTo(this.edges[d]),this.edges[d].draw();this.__beforeDragLayer.draw(),this.drag.draw(),this.dragEdges.draw()},e.prototype={createNode:function(a,c){var d=new b(a,c);return this.layers.addNode(d),d},removeNode:function(a,b){this.layers.removeNode(b)},createEdge:function(a,b,d,e,f){var g=new c(a,b,d,e,f);return this.layers.addEdge(g),g},removeEdge:function(a,b){this.layers.removeEdge(b)},clear:function(){}},a.GS.extend(a.GS.Context.prototype,e.prototype),setInterval(function(){for(var a=0;a<d.prototype.layers.length;a++)d.prototype.layers[a].drawAll()},25),a.GS.registerContext("canvas",e)}(this),function(a){"use strict";function b(){a.GS.FileSource.call(this,"DGS"),c.source=this}if(void 0===a.GS)throw new Error("GS is not loaded");var c={lines:[],line:"",source:null};b.prototype.begin=function(b,d){var e=this;return new a.Promise(function(f,g){var h=function(a){c.setData(a),f(e)};d?h(b):a.jQuery.get(b).then(h,function(a){g(a)})})},b.prototype.nextEvents=function(){var a=c.parseOneLine();return a},b.prototype.nextStep=function(){for(var a=!1;c.ready()&&"st"!==c.parseOneLine();)a=!0;return a},b.prototype.readAll=function(){c.parseAll()},b.prototype.end=function(){},a.GS.extend(a.GS.FileSource.prototype,b.prototype),c.setData=function(a){var b,d;if(c.lines=a.split("\n").reverse(),d=c.lines.pop(),b=/^DGS00\d$/,!b.test(d))throw new Error('invalid dgs header "'+d+'"');if(d=c.lines.pop(),b=/^\S+ \d+ \d+$/,!b.test(d))throw new Error('invalid dgs header "'+d+'"');for(var e=0;e<c.lines.length;)""===c.lines[e]||"#"===c.lines[e].charAt(0)?c.lines.splice(e,1):e++},c.setData=function(a){var b,d;if(c.lines=a.split("\n").reverse(),d=c.lines.pop(),b=/^DGS00\d$/,!b.test(d))throw new Error('invalid dgs header "'+d+'"');if(d=c.lines.pop(),b=/^\S+ \d+ \d+$/,!b.test(d))throw new Error('invalid dgs header "'+d+'"');for(var e=0;e<c.lines.length;)""===c.lines[e]||"#"===c.lines[e].charAt(0)?c.lines.splice(e,1):e++},c.ready=function(){return c.lines.length>0},c.next=function(){return c.line=c.lines.pop(),this},c.dir=function(){if(null!==c.line.match(/^\s*#/))return"#";var a=c.line.substr(0,2).toLowerCase();return c.line=c.line.substr(3,c.line.length-3),a},c.parseOneLine=function(){var a,b,d,e,f;switch(c.next(),a=c.dir()){case"an":b=c.nextId(),c.source.sendNodeAdded(b),c.parseAttributes("node",b);break;case"cn":b=c.nextId(),c.parseAttributes("node",b);break;case"dn":b=c.nextId(),c.source.sendNodeRemoved(b);break;case"ae":b=c.nextId(),d=c.nextId(),f=c.isDirectedEdge(),e=c.nextId(),c.source.sendEdgeAdded(b,d,e,f),c.parseAttributes("edge",b);break;case"ce":b=c.nextId(),c.parseAttributes("edge",b);break;case"de":b=c.nextId(),c.source.sendEdgeRemoved(b);break;case"cg":b=c.nextId(),c.parseAttributes("graph",b);break;case"st":c.source.sendStepBegins(c.nextReal());break;case"cl":c.source.sendGraphCleared.cl();break;case"#":break;default:throw new Error('DSG Parser unknown directive "'+a+'"')}return a},c.parseAll=function(){for(;c.ready();)c.parseOneLine()},c.nextId=function(){var a=/^\s*(?:'([^']+)'|"([^"]+)"|([\w\d-_]+))(?:(.*))?$/,b=a.exec(c.line);if(null===b)throw new Error("DSG Parser Problem with ids reading that line :"+c.line);return c.line=b[4],b[1]||b[2]||b[3]},c.isDirectedEdge=function(){var a=/^\s*(>)(?:(.*))?$/,b=a.exec(c.line);return null===b?!1:void 0!==b[1]&&">"===b[1]?(c.line=b[2],!0):!1},c.nextReal=function(){var a=/^(\d+(?:\.\d+)?)$/,b=a.exec(c.line);return b[1]},c.parseAttributes=function(a,b){function d(b){var c,f,g,h,i,j,k=[];if(null===f)throw new Error("No value could be read on line: "+e.line);do{switch(c=/^\s*(([^\s])(.*))/,f=c.exec(e.line),f[2]){case"'":case'"':if(g=/^([^'^"]*)['"](.*)$/,h=g.exec(f[3]),null===h)throw new Error("Could not read a string on line: "+e.line);k.push(h[1]),e.line=h[2];break;case"#":if(g=/^(#[a-fA-F0-9]{6}|[a-fA-F0-9]{3})(.*)/,h=g.exec(f[1]),null===h)throw new Error("Could not read a color on line: "+e.line);k.push(h[1]),e.line=h[2];break;case"{":e.line=f[3];var l=d(!0);if(g=/^\s*((\})(.*))/,h=g.exec(e.line),null===h)throw new Error("Could not read a table on line: "+e.line);k.push(l),e.line=h[3];break;case"[":for(i={},g=/^\s*([^\s])/,h=g.exec(f[3]),e.line=f[3],j=h[1];"]"!==j;){if(g=/^\s*(?:"([^"]*)"|'([^']*)'|(\w[[\w.]*))\s*[:=](.*)$/,h=g.exec(e.line),null===h)throw new Error("Could not read a hash on line: "+e.line);var m=h[1]||h[2]||h[3];e.line=h[4];var n=d(!1);if(i[m]=n,g=/^\s*(([^\s])(.*))/,h=g.exec(e.line),j=h[2],"]"!==j&&","!==j)throw new Error("Could not read a hash on line: "+e.line);e.line=h[3]}k.push(i);break;default:if(g=/\s*(?:([+-]?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?)|(\w[-\w.]*)|"([^"]*)"|'([^']*)')(.*)$/,h=g.exec(f[1]),null===h)throw new Error("Could not read a word or number on line: "+e.line);var o="undefined"!=typeof h[1]?parseFloat(h[1],10):h[2]||h[3]||h[4];k.push(o),e.line=h[5]}if("graph"===a)return f[3].substring(0,f[3].length-1);if(c=/^\s*(([^\s]|)(.*))/,f=c.exec(e.line),null===f)throw new Error("No value could be read on line: "+e.line);","===f[2]&&b&&(e.line=f[3])}while(","===f[2]&&b);return 1===k.length?k[0]:k}var e=this;if("undefined"!=typeof c.line&&null===c.line.match(/^\s*$/)){var f,g,h,i=/^\s*([+-]?)(?:"([^"]*)"|'([^']*)'|(\w[[\w.]*))(.*?)$/,j=i.exec(c.line);if("."===c.line.charAt(0)&&(j=i.exec("ui"+c.line)),":"===c.line.charAt(0)&&(j=i.exec("ui.stylesheet"+c.line)),null!==j){if(f="-"===j[1]?!0:!1,g=j[2]||j[3]||j[4],c.line=j[5],i=/\s*([:=])?(.*?)$/,j=i.exec(c.line),"undefined"!=typeof j[1]&&(c.line=j[2],h=d(!0)),f)switch(a){case"node":c.source.sendNodeAttributeRemoved(b,g);break;case"edge":c.source.sendEdgeAttributeRemoved(b,g);break;case"graph":c.source.sendGraphAttributeRemoved(g)}else switch(a){case"node":c.source.sendNodeAttributeAdded(b,g,h);break;case"edge":c.source.sendEdgeAttributeAdded(b,g,h);break;case"graph":c.source.sendGraphAttributeAdded(g,h)}""===c.line||c.line.contains(")")||c.parseAttributes(a,b)}}},a.GS.FileSourceDGS=b}(window),function(a){"use strict";function b(a){this.graph=a,this.nodes=[],this.links=[];var b;this.graph.addSink(this);for(b in this.graph.nodes)this.registerNode(b);for(b in this.graph.edges)this.registerEdge(b)}function c(a){b.call(this,a),this.layout_running=!1,this.layout=d3.layout.force().gravity(0).charge(-15).linkDistance(30);var c=this;this.layout.on("tick",function(){c.pushXY()})}b.prototype={start:function(){},reload:function(){},stop:function(){},registerNode:function(a){var b=this.graph.nodes[a];
b.layoutIndex=this.nodes.length,this.nodes.push({id:a})},unregisterNode:function(a){var b=this.graph.nodes[a];this.nodes.splice(b.layoutIndex,1)},registerEdge:function(a){var b=this.graph.edges[a];b.layoutIndex=this.links.length,this.links.push({id:a,source:this.nodes[b.source.layoutIndex],target:this.nodes[b.target.layoutIndex],value:1})},unregisterEdge:function(a){var b=this.graph.edges[a];this.links.splice(b.layoutIndex,1)},nodeAdded:function(a,b,c){this.registerNode(c),this.reload()},nodeRemoved:function(a,b,c){this.unregisterNode(c),this.reload()},edgeAdded:function(a,b,c){this.registerEdge(c),this.reload()},edgeRemoved:function(a,b,c){this.unregisterEdge(c),this.reload()},graphCleared:function(){this.nodes=[],this.links=[],this.reload()},pushXY:function(){for(var a=0;a<this.nodes.length;a++)this.graph.setXY(this.nodes[a].id,this.nodes[a].x,this.nodes[a].y)},nodeAttributeAdded:function(){},nodeAttributeChanged:function(){},nodeAttributeRemoved:function(){},edgeAttributeAdded:function(){},edgeAttributeChanged:function(){},edgeAttributeRemoved:function(){},graphAttributeAdded:function(){},graphAttributeChanged:function(){},graphAttributeRemoved:function(){},stepBegins:function(){}},a.GS.extend(a.GS.Sink.prototype,b.prototype),c.prototype={start:function(){this.layout_running=!0,this.reload()},reload:function(){this.layout_running&&this.layout.stop(),this.layout.nodes(this.nodes).links(this.links),this.layout_running&&this.layout.start()},stop:function(){this.layout_running=!1,this.layout.stop()}},a.GS.extend(b.prototype,c.prototype),a.GS.Layout=b,a.GS.ForceLayout=c}(this),function(a){"use strict";function b(b,c){a.GS.Node.call(this,b,c);var d=g[0];this.shape=new THREE.Mesh(d,new THREE.MeshLambertMaterial),this.shape.type="Node",f[this.shape.id]=this.shape,b.context.wnodes(this.shape)}function c(b,c,d,e,g){a.GS.Edge.call(this,b,c,d,e,g);var h=new THREE.Geometry;h.vertices.push(d.shape.position),h.vertices.push(e.shape.position),this.shape=new THREE.Line(h,new THREE.LineBasicMaterial({vertexColors:!0})),this.shape.type="Edge",this.shape.geometry.computeBoundingSphere(),f[this.shape.id]=this.shape,b.context.wedges(this.shape)}function d(a){function b(){requestAnimationFrame(b),q.update(),d(),r.render(s.scene,n)}function c(a,b){b.style.backgroundColor="Node"===a.type?"#"+a.material.color.getHexString():"#"+a.geometry.colors[0].getHexString()}function d(){for(var a in e){var b,d=e[a],i=f[a],j=h(i),k=g(i);b="Node"===i.type?i.position:i.geometry.boundingSphere.center;var o=l.projectVector(b.clone(),n),p=b.distanceTo(n.position);k&&j&&m>p?(d.style.display="",c(i,d),o.x=(1+o.x)/2*window.innerWidth-d.clientWidth/2,o.y=(1-o.y)/2*window.innerHeight-d.clientHeight/2,d.style.top=o.y+"px",d.style.left=o.x+"px"):d.style.display="none"}}function g(a){var b;b="Node"===a.type?a.position.clone():a.geometry.boundingSphere.center.clone();var c=n.position.clone(),d=b.sub(c).normalize(),e=new THREE.Raycaster(c,d),f=e.intersectObjects(s.scene.children,!0);return f[0]&&a.id!==f[0].object.id?!1:!0}function h(a){n.updateMatrix(),n.updateMatrixWorld(),n.matrixWorldInverse.getInverse(n.matrixWorld),a.updateMatrix(),a.updateMatrixWorld();var b=new THREE.Frustum;return b.setFromMatrix((new THREE.Matrix4).multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse)),b.intersectsObject(a)}function i(){n.aspect=document.getElementById("three").offsetWidth/document.getElementById("three").offsetHeight,n.updateProjectionMatrix(),r.setSize(document.getElementById("three").offsetWidth,document.getElementById("three").offsetHeight)}GS.Context.call(this,a),this.webgl=document.getElementById("three");var j=this.webgl.offsetWidth,k=this.webgl.offsetHeight,l=new THREE.Projector;this.list_labels=[],this.list_objects=[];var m=400;this.scene=new THREE.Scene;var n=new THREE.PerspectiveCamera(50,j/k,1,1e4);n.position.set(-125,-125,300),n.up.set(0,0,1);var o=new THREE.AmbientLight(5592405),p=new THREE.DirectionalLight(8947848,1.5);p.position.set(-10,-50,100),this.scene.add(o),this.scene.add(p);var q=new THREE.TrackballControls(n);q.rotateSpeed=1.5,q.zoomSpeed=10,q.panSpeed=1.5,q.noZoom=!1,q.noPan=!1,q.staticMoving=!0,window.addEventListener("resize",i,!1);var r=new THREE.WebGLRenderer({antialias:!0});r.setSize(j,k),this.webgl.appendChild(r.domElement);var s=this;b()}if(void 0===a.GS)throw new Error("GS is not loaded");var e=[],f=[],g=[new THREE.SphereGeometry(1,16,16),new THREE.BoxGeometry(1,1,1),new THREE.TetrahedronGeometry(1),new THREE.OctahedronGeometry(1),new THREE.TorusGeometry(1,.3,8,16)];b.prototype={setFill:function(a){this.shape.material.color=new THREE.Color(a)},setStroke:function(a){this.setFill(a)},setStrokeWidth:function(a){this.setSize(a)},setSize:function(a){this.shape.scale.set(a,a,a)},setClass:function(a){this.className=a},setHide:function(a){this.shape.visible=a},setShape:function(a){var b=0;switch(a){case"cube":b=1;break;case"tetra":b=2;break;case"octa":b=3}this.shape_name=a;var c=g[b];this.shape.geometry=c.clone(),this.shape.geometry.buffersNeedUpdate=!0},updateShapePosition:function(){this.shape.position.set(this._x,this._y,this._z)},setLabel:function(a){var b=this.shape.position,c="#"+this.shape.material.color.getHexString(),d=document.createElement("div");d.style.position="absolute",d.style.width=100,d.style.height=100,d.innerHTML=a,d.style.backgroundColor=c,d.style.left=b.x+"px",d.style.top=b.y+"px",d.style.display="none",document.body.appendChild(d),void 0!==e[this.shape.id]&&(e[this.shape.id].style.display="none",delete e[this.shape.id]),e[this.shape.id]=d}},c.prototype={setStroke:function(a){this.shape.geometry.colors[0]=new THREE.Color(a),this.shape.geometry.colors[1]=new THREE.Color(a),this.shape.geometry.colorsNeedUpdate=!0},setStrokeWidth:function(a){this.shape.material.linewidth=a},setSize:function(a){this.setStrokeWidth(a)},setClass:function(a){this.className=a},setHide:function(a){this.shape.visible=a},updateShapePosition:function(){this.shape.geometry.computeBoundingSphere()},setLabel:function(a){var b=this.shape.geometry.boundingSphere.center,c="#"+this.shape.geometry.colors[0].getHexString(),d=document.createElement("div");d.style.position="absolute",d.style.width=100,d.style.height=100,d.innerHTML=a,d.style.backgroundColor=c,d.style.left=b.x+"px",d.style.top=b.y+"px",d.style.display="none",document.body.appendChild(d),void 0!==e[this.shape.id]&&(e[this.shape.id].style.display="none",delete e[this.shape.id]),e[this.shape.id]=d}},a.GS.extend(a.GS.Node.prototype,b.prototype),a.GS.extend(a.GS.Edge.prototype,c.prototype),d.prototype={wnodes:function(a){this.scene.add(a)},createNode:function(a,c){var d=new b(a,c);return d},removeNode:function(a,b){var c=b.shape.id;this.scene.remove(b.shape),void 0!==e[c]&&(e[c].style.display="none",delete e[c],delete f[c])},wedges:function(a){this.scene.add(a)},createEdge:function(a,b,d,e,f){var g=new c(a,b,d,e,f);return g},removeEdge:function(a,b){var c=b.shape.id;this.scene.remove(b.shape),void 0!==e[c]&&(e[c].style.display="none",delete e[c],delete f[c])},clear:function(){},zoom:function(){}},a.GS.extend(GS.Context.prototype,d.prototype),a.GS.registerContext("webgl",d)}(this);
//# sourceMappingURL=w3sink.min.map