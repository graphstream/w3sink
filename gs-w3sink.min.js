(function(d){function j(p,q){for(var o in p){if(!q.hasOwnProperty(o)){q[o]=p[o]}}}function n(o,r){var q=/(\d+)(\w+)?/;var p=q.exec(r);return p[1]}function c(o){this.id=o;this.timeId=0;this.sinks=[]}c.prototype={addSink:function(o){this.sinks.push(o)},removeSink:function(o){},newTimeId:function(){return this.timeId++},sendNodeAdded:function(q){var p=this.newTimeId();for(var o=0;o<this.sinks.length;o++){this.sinks[o].nodeAdded(this.id,p,q)}},sendNodeRemoved:function(q){var p=this.newTimeId();for(var o=0;o<this.sinks.length;o++){this.sinks[o].nodeRemoved(this.id,p,q)}},sendNodeAttributeAdded:function(s,r,q){var p=this.newTimeId();for(var o=0;o<this.sinks.length;o++){this.sinks[o].nodeAttributeAdded(this.id,p,s,r,q)}},sendNodeAttributeChanged:function(u,r,o,s){var q=this.newTimeId();if(s===undefined){s=o}for(var p=0;p<this.sinks.length;p++){this.sinks[p].nodeAttributeChanged(this.id,q,u,r,o,s)}},sendNodeAttributeRemoved:function(r,q){var p=this.newTimeId();for(var o=0;o<this.sinks.length;o++){this.sinks[o].nodeAttributeRemoved(this.id,p,r,q)}},sendEdgeAdded:function(u,r,s,q){var p=this.newTimeId();if(q===undefined){q=false}for(var o=0;o<this.sinks.length;o++){this.sinks[o].edgeAdded(this.id,p,u,r,s,q)}},sendEdgeRemoved:function(q){var p=this.newTimeId();for(var o=0;o<this.sinks.length;o++){this.sinks[o].edgeRemoved(this.id,p,q)}},sendEdgeAttributeAdded:function(s,r,q){var p=this.newTimeId();for(var o=0;o<this.sinks.length;o++){this.sinks[o].edgeAttributeAdded(this.id,p,s,r,q)}},sendEdgeAttributeChanged:function(u,r,o,s){var q=this.newTimeId();if(s===undefined){s=o}for(var p=0;p<this.sinks.length;p++){this.sinks[p].edgeAttributeChanged(this.id,q,u,r,o,s)}},sendEdgeAttributeRemoved:function(r,q){var p=this.newTimeId();for(var o=0;o<this.sinks.length;o++){this.sinks[o].edgeAttributeRemoved(this.id,p,r,q)}},sendGraphAttributeAdded:function(r,q){var p=this.newTimeId();for(var o=0;o<this.sinks.length;o++){this.sinks[o].graphAttributeAdded(this.id,p,r)}},sendGraphAttributeChanged:function(r,o,s){var q=this.newTimeId();if(s===undefined){s=o}for(var p=0;p<this.sinks.length;p++){this.sinks[p].graphAttributeChanged(this.id,q,r,o,s)}},sendGraphAttributeRemoved:function(q){var p=this.newTimeId();for(var o=0;o<this.sinks.length;o++){this.sinks[o].graphAttributeRemoved(this.id,p,q)}},sendGraphCleared:function(){var p=this.newTimeId();for(var o=0;o<this.sinks.length;o++){this.sinks[o].graphCleared(this.id,p)}},sendStepBegins:function(q){var p=this.newTimeId();for(var o=0;o<this.sinks.length;o++){this.sinks[o].stepBegins(this.id,p,q)}}};function b(){}b.prototype={nodeAdded:function(p,o,q){},nodeRemoved:function(p,o,q){},nodeAttributeAdded:function(r,o,s,q,p){},nodeAttributeChanged:function(r,p,t,q,o,s){},nodeAttributeRemoved:function(q,o,r,p){},edgeAdded:function(r,p,t,q,s,o){},edgeRemoved:function(p,o,q){},edgeAttributeAdded:function(r,o,s,q,p){},edgeAttributeChanged:function(r,p,t,q,o,s){},edgeAttributeRemoved:function(q,o,r,p){},graphAttributeAdded:function(r,o,q,p){},graphAttributeChanged:function(r,p,q,o,s){},graphAttributeRemoved:function(q,o,p){},graphCleared:function(p,o){},stepBegins:function(q,p,o){}};function a(p,o,q){this.id=q;this.type=o;this.graph=p;this.attributes={}}a.prototype={getAttribute:function(o){return this.attributes[o]},setAttribute:function(o,p){this.attributes[o]=p},hasAttribute:function(o){return this.attributes.hasOwnProperty(o)},removeAttribute:function(o){delete this.attributes[o]},setFill:function(o){},setStroke:function(o){},setStrokeWidth:function(o){},setSize:function(o){},setLabel:function(o){},setStyle:function(r){var s=r.split(/\s*;\s*/);for(var q=0;q<s.length;q++){if(s[q]===""){continue}var p=s[q].split(/\s*:\s*/);switch(p[0]){case"fill-color":var o=p[1].split(/\s*,\s*/);this.setFill(o[0]);break;case"stroke-color":var o=p[1].split(/\s*,\s*/);this.setStroke(o[0]);break;case"stroke-width":this.setStrokeWidth(n(this,p[1]));break;case"z-index":this.setZIndex(p[1]);break;case"size":this.setSize(n(this,p[1]));break;case"fill-image":case"fill-mode":case"stroke-mode":case"padding":case"shadow-mode":case"shadow-color":case"shadow-width":case"shadow-offset":case"text-mode":case"text-background-mode":case"text-visibility-mode":case"text-visibility":case"text-color":case"text-background-color":case"text-style":case"text-alignment":case"text-padding":case"text-offset":case"text-font":case"text-size":case"icon":case"icon-mode":case"visibility":case"visibility-mode":case"size-mode":case"shape":case"arrow-shape":case"arrow-image":case"arrow-size":case"shape-points":console.log("[GraphStream CSS] unsupported property '"+p[0]+"' for "+this.type);break;default:console.log("[GraphStream CSS] unknown property '"+p[0]+"' for "+this.type);break}}},updateShapePosition:function(){}};function h(o,p){a.call(this,o,"Node",p);this.edges={};this._x=0;this._y=0;this.pixelX=o.randomPixelX();this.pixelY=o.randomPixelY();this.index=o.indexedNodes.length;o.indexedNodes.push(this)}h.prototype={registerEdge:function(o){this.edges[o.id]=o},unregisterEdge:function(o){delete this.edges[o.id]},x:function(o){if(typeof(o)==="undefined"){return this._x}this._x=o;for(var p in this.edges){this.edges[p].nodePositionChanged(this)}},y:function(p){if(typeof(p)==="undefined"){return this._y}this._y=p;for(var o in this.edges){this.edges[o].nodePositionChanged(this)}},setXY:function(o,p){this._x=o;this._y=p;this.graph.viewbox.check(o,p);this.graph.viewbox.update(this)},setPixelXY:function(o,q){this.pixelX=o;this.pixelY=q;this.updateShapePosition();for(var p in this.edges){this.edges[p].nodePositionChanged()}return this}};function g(q,s,p,r,o){a.call(this,q,"Edge",s);this.source=p;this.target=r;this.directed=o;this.points=[{x:p.pixelX,y:p.pixelY},{x:r.pixelX,y:r.pixelY}];this.index=q.indexedEdges.length;q.indexedEdges.push(this)}g.prototype={nodePositionChanged:function(){this.points[0].x=this.source.pixelX;this.points[0].y=this.source.pixelY;this.points[this.points.length-1].x=this.target.pixelX;this.points[this.points.length-1].y=this.target.pixelY;this.updateShapePosition()}};j(a.prototype,h.prototype);j(a.prototype,g.prototype);function l(o,p){c.call(this,o);if(typeof(p)==="undefined"){p="default"}if(!e.hasOwnProperty(p)){throw new Error("context '"+p+"' is not registered")}this.context=new e[p](o);this.nodes={};this.edges={};this.indexedNodes=[];this.indexedEdges=[];this.default_node_style="fill-color:#89a9e3;size:10px;stroke-color:#333333;stroke-width:5px;";this.default_node_size=15;this.default_edge_style="stroke-color:#333333;stroke-width:2px;";this.viewbox=new f(this);this.dispatch=new b();this._width=jQuery(this.context.getCanvas()).width();this._height=jQuery(this.context.getCanvas()).height()}l.prototype={width:function(){return this._width},height:function(){return this._height},an:function(p){if(this.nodes.hasOwnProperty(p)){console.log("[warning] node exists '"+p+"'");return}var o=this.context.createNode(this,p);this.nodes[p]=o;o.setStyle(this.default_node_style);this.nodesCount++;this.sendNodeAdded(p)},cn:function(r,o,p){var q=this.nodes[r];if(p===undefined){q.removeAttribute(o);this.sendNodeAttributeRemoved(r,o)}else{if(o==="xy"||o==="xyz"){q.setXY(p[0],p[1])}else{if(o==="size"){q.setSize(p)}else{if(o==="style"){q.setStyle(p)}else{if(o==="label"){q.setLabel(p)}}}}q.setAttribute(o,p);this.sendNodeAttributeChanged(r,o,p)}},setXY:function(r,o,q){var p=this.nodes[r];p.setXY(o,q)},setPixelXY:function(r,o,q){var p=this.nodes[r];p.setPixelXY(o,q)},dn:function(v){var o=[];var u=this.nodes[v];for(var p in this.edges){if(this.edges[p].source.id==v||this.edges[p].target.id==v){o.push(this.edges[r])}}for(var r=0;r<o.length;r++){this.de(o[r].id)}this.sendNodeRemoved(v);this.context.removeNode(this,u);if(u.index===this.indexedNodes.length-1){this.indexedNodes.pop()}else{var s=this.indexedNodes[this.indexedNodes.length-1];var t=s.index,q=u.index;s.index=q;this.indexedNodes[q]=s;this.indexedNodes.pop();this.context.nodeIndexChanged(s,t,q)}delete this.nodes[v]},ae:function(s,r,o,p){if(this.nodes[r]===undefined){console.log("node '"+r+"' not found for edge '"+s+"'");return}if(this.nodes[o]===undefined){console.log("node '"+o+"' not found for edge '"+s+"'");return}var q=this.context.createEdge(this,s,this.nodes[r],this.nodes[o],p);this.edges[s]=q;q.setStyle(this.default_edge_style);this.nodes[r].edges[s]=q;this.nodes[o].edges[s]=q;this.edgesCount++;this.sendEdgeAdded(s,r,o,p)},ce:function(r,o,p){var q=this.edges[r];if(typeof(p)=="undefined"){q.removeAttribute(q);this.sendEdgeAttributeRemoved(r,o)}else{if(o==="style"){q.setStyle(p)}else{if(o==="size"){q.setSize(p)}}q.setAttribute(o,p);this.sendEdgeAttributeChanged(r,o,p)}},de:function(s){var q=this.edges[s];this.sendEdgeRemoved(s);this.context.removeEdge(this,q);delete q.source.edges[s];delete q.target.edges[s];if(q.index===this.indexedEdges.length-1){this.indexedEdges.pop()}else{var p=this.indexedEdges[this.indexedEdges.length-1];var r=p.index,o=q.index;p.index=o;this.indexedEdges[o]=p;this.indexedEdges.pop();this.context.edgeIndexChanged(p,r,o)}delete this.edges[s]},cg:function(p,o){},cl:function(){this.context.clear();this.sendGraphCleared()},st:function(o){this.sendStepBegins(o)},randomPixelX:function(o){if(o===undefined){o=Math.random()}return ~~(o*this.width())},randomPixelY:function(o){if(o===undefined){o=Math.random()}return ~~(o*this.height())},nodeAdded:function(p,o,q){this.an(q)},nodeRemoved:function(p,o,q){this.dn(q)},nodeAttributeAdded:function(r,p,s,o,q){this.cn(s,o,q)},nodeAttributeChanged:function(r,q,t,p,o,s){this.cn(t,p,s)},nodeAttributeRemoved:function(q,p,r,o){this.cn(r,o,value)},edgeAdded:function(q,p,r,t,s,o){this.ae(r,t,s,o)},edgeRemoved:function(p,o,q){this.de(q)},edgeAttributeAdded:function(r,p,s,o,q){this.ce(s,o,q)},edgeAttributeChanged:function(r,q,t,p,o,s){this.ce(t,p,s)},edgeAttributeRemoved:function(q,p,r,o){this.ce(r,o,value)},graphAttributeAdded:function(r,p,o,q){this.cg(o,q)},graphAttributeChanged:function(r,q,p,o,s){this.cg(p,s)},graphAttributeRemoved:function(q,p,o){this.cg(o,value)},graphCleared:function(p,o){this.cl()},stepBegins:function(q,p,o){this.st(o)}};j(c.prototype,l.prototype);function m(o){this.container=document.querySelector(o)}m.prototype={getContainer:function(){return this.container},createNode:function(o,p){return new h(o,p)},removeNode:function(p,o){},createEdge:function(q,s,p,r,o){return new g(q,s,p,r,o)},removeEdge:function(p,o){},clear:function(o){},zoom:function(o){},nodeIndexChanged:function(p,q,o){},edgeIndexChanged:function(p,q,o){}};function f(o){this.graph=o;this.minx=Infinity;this.miny=Infinity;this.maxx=-Infinity;this.maxy=-Infinity;this.padding={top:15,right:15,bottom:15,left:15}}f.prototype={reset:function(){this.minx=Infinity;this.miny=Infinity;this.maxx=-Infinity;this.maxy=-Infinity},check:function(o,q){var p=false;if(o<this.minx){p=true;this.minx=o}if(q<this.miny){p=true;this.miny=q}if(o>this.maxx){p=true;this.maxx=o}if(q>this.maxy){p=true;this.maxy=q}if(p){if(this.minx===this.maxx){this.minx-=0.1;this.maxx+=0.1}if(this.miny===this.maxy){this.miny-=0.1;this.maxy+=0.1}this.update()}},compute:function(){var r,q,o,t;r=q=Infinity;o=t=-Infinity;for(var s in this.graph.nodes){var p=this.graph.nodes[s];r=Math.min(r,p._x);q=Math.min(q,p._y);o=Math.max(o,p._x);t=Math.max(t,p._y)}this.minx=r;this.miny=q;this.maxx=o;this.maxy=t;this.update()},update:function(q){if(q===undefined){for(var r in this.graph.nodes){this.update(this.graph.nodes[r])}}else{var p=(q._x-this.minx)/(this.maxx-this.minx),o=(q._y-this.miny)/(this.maxy-this.miny);p=this.padding.left+(this.graph.width()-this.padding.left-this.padding.right)*p;o=this.padding.bottom+(this.graph.height()-this.padding.bottom-this.padding.top)*o;q.setPixelXY(p,o)}}};var e={"default":m};function i(o,p){e[o]=p}var k={extend:j,Node:h,Edge:g,Graph:l,Context:m,Source:c,Sink:b,registerContext:i};d.GS=k}(this));(function(a){var e={ns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink"};function d(f,g){GS.Node.call(this,f,g);this.shape={g:document.createElementNS(e.ns,"g"),node:document.createElementNS(e.ns,"circle"),title:document.createElementNS(e.ns,"title"),label:document.createElementNS(e.ns,"text"),labelText:document.createTextNode(""),labelStroke:document.createElementNS(e.ns,"text"),labelStrokeText:document.createTextNode("")};this.shape.g.setAttribute("transform","translate("+this.pixelX+","+this.pixelY+")");this.shape.node.setAttribute("class","node");this.shape.node.setAttribute("r",f.default_node_size);this.shape.node.setAttribute("cx",0);this.shape.node.setAttribute("cy",0);this.shape.node.setAttribute("fill","black");this.shape.node.setAttribute("stroke","white");this.shape.node.setAttribute("stroke-width","2px");this.shape.title.textContent=g;this.shape.label.setAttribute("font-size","12px");this.shape.label.setAttribute("fill","#ff7200");this.shape.labelStroke.setAttribute("font-size","12px");this.shape.labelStroke.setAttribute("fill","#ff7200");this.shape.labelStroke.setAttribute("stroke","#222222");this.shape.labelStroke.setAttribute("stroke-width",5);this.shape.label.appendChild(this.shape.labelText);this.shape.labelStroke.appendChild(this.shape.labelStrokeText);this.shape.g.appendChild(this.shape.node);this.shape.g.appendChild(this.shape.title);this.shape.g.appendChild(this.shape.labelStroke);this.shape.g.appendChild(this.shape.label);f.context.gnodes.appendChild(this.shape.g)}d.prototype={setFill:function(f){this.shape.node.setAttribute("fill",f)},setStroke:function(f){this.shape.node.setAttribute("stroke",f)},setStrokeWidth:function(f){this.shape.node.setAttribute("stroke-width",f)},setSize:function(f){this.shape.node.setAttribute("r",f)},setLabel:function(f){if(f===undefined){f=this.id}this.shape.labelText.textContent=f;this.shape.labelStrokeText.textContent=f},updateShapePosition:function(){this.shape.g.setAttribute("transform","translate("+this.pixelX+","+this.pixelY+")");if(this.pixelX<this.graph.width()/2){this.shape.label.setAttribute("text-anchor","start");this.shape.labelStroke.setAttribute("text-anchor","start")}else{this.shape.label.setAttribute("text-anchor","end");this.shape.labelStroke.setAttribute("text-anchor","end")}}};function c(h,j,g,i,f){GS.Edge.call(this,h,j,g,i,f);this.shape=document.createElementNS(e.ns,"line");this.shape.setAttribute("class","edge");this.shape.setAttribute("x1",g.pixelX);this.shape.setAttribute("y1",g.pixelY);this.shape.setAttribute("x2",i.pixelX);this.shape.setAttribute("y2",i.pixelY);this.shape.setAttribute("stroke","black");this.shape.setAttribute("stroke-width","1px");h.context.gedges.appendChild(this.shape)}c.prototype={setStroke:function(f){this.shape.setAttribute("stroke",f)},setStrokeWidth:function(f){this.shape.setAttribute("stroke-width",f)},setSize:function(f){this.setStrokeWidth(f)},updateShapePosition:function(){this.shape.setAttribute("x1",this.points[0].x);this.shape.setAttribute("y1",this.points[0].y);this.shape.setAttribute("x2",this.points[this.points.length-1].x);this.shape.setAttribute("y2",this.points[this.points.length-1].y)}};GS.extend(GS.Node.prototype,d.prototype);GS.extend(GS.Edge.prototype,c.prototype);function b(f){GS.Context.call(this,f);this.svg=document.createElementNS(e.ns,"svg:svg");this.svg.setAttribute("width","100%");this.svg.setAttribute("height","100%");this.svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",e.xlinkns);this.container.appendChild(this.svg);this.root=document.createElementNS(e.ns,"g");this.gedges=document.createElementNS(e.ns,"g");this.gnodes=document.createElementNS(e.ns,"g");this.root.appendChild(this.gedges);this.root.appendChild(this.gnodes);this.svg.appendChild(this.root)}b.prototype={createNode:function(f,g){var h=new d(f,g);return h},removeNode:function(g,f){this.gnodes.removeChild(f.shape.g)},createEdge:function(h,k,g,j,f){var i=new c(h,k,g,j,f);return i},removeEdge:function(g,f){this.gedges.removeChild(f.shape)},clear:function(f){},zoom:function(f){this.svg.setAttribute("transform","scale("+f+")")}};a.GS.extend(GS.Context.prototype,b.prototype);a.GS.registerContext("svg",b)}(this));(function(a){function e(f,g){GS.Node.call(this,f,g);this.shape=new Kinetic.Circle({x:f.randomPixelX(),y:f.randomPixelY(),radius:15,fill:"black",stroke:"white",strokeWidth:2})}e.prototype={updateShapePosition:function(){this.shape.setX(this.pixelX);this.shape.setY(this.pixelY);this.graph.context.layers.drawLayerOf(this)},setFill:function(f){this.shape.setFill(f)},setStroke:function(f){this.shape.setStroke(f)},setStrokeWidth:function(f){this.shape.setStrokeWidth(f)},setSize:function(f){this.shape.setRadius(f)}};GS.extend(GS.Node.prototype,e.prototype);function d(h,j,g,i,f){GS.Edge.call(this,h,j,g,i,f);this.shape=new Kinetic.Line({points:this.points,stroke:"black",strokeWidth:2,lineJoin:"round",lineCap:"round"})}d.prototype={updateShapePosition:function(){this.shape.setPoints(this.points);this.graph.context.layers.drawLayerOf(this)},setFill:function(f){this.shape.setFill(f)},setStroke:function(f){this.shape.setStroke(f)},setStrokeWidth:function(f){this.shape.setStrokeWidth(f)}};GS.extend(GS.Edge.prototype,d.prototype);function c(h,k,g){c.prototype.layers.push(this);if(k===undefined){k=4}if(g===undefined){g=k}this.stage=h;this.drag=new Kinetic.Layer("drag");this.dragEdges=new Kinetic.Layer("dragEdges");this.nodes=[];this.edges=[];for(var j=0;j<g;j++){var f=new Kinetic.Layer("edges#"+j);f.changed=true;this.edges.push(f);this.stage.add(f)}this.stage.add(this.dragEdges);for(var j=0;j<k;j++){var f=new Kinetic.Layer("nodes#"+j);f.changed=true;this.nodes.push(f);this.stage.add(f)}this.stage.add(this.drag)}c.prototype.layers=[];c.prototype.addNode=function(g){var f=~~(Math.random()*this.nodes.length);this.nodes[f].add(g.shape);this.nodes[f].changed=true};c.prototype.addEdge=function(f){var g=~~(Math.random()*this.edges.length);this.edges[g].add(f.shape);this.edges[g].changed=true};c.prototype.removeNode=function(g){var f=g.shape.getLayer();f.remove(g.shape);f.changed=true};c.prototype.removeEdge=function(g){var f=g.shape.getLayer();f.remove(g.shape);f.changed=true};c.prototype.drawLayerOf=function(f){f.shape.getLayer().changed=true};c.prototype.drawAll=function(){for(var f=0;f<this.edges.length;f++){if(this.edges[f].changed){this.edges[f].draw();this.edges[f].changed=false}}for(var f=0;f<this.nodes.length;f++){if(this.nodes[f].changed){this.nodes[f].draw();this.nodes[f].changed=false}}};c.prototype.dragStart=function(j){this.__beforeDragLayer=j.shape.getLayer();j.shape.moveTo(this.drag);j.shape.draggable(true);for(var h=0;h<this.nodes.length;h++){this.nodes[h].listen(false)}for(var g in j.edges){var f=j.edges[g].shape.getLayer();j.edges[g].shape.moveTo(this.dragEdges);f.draw()}this.__beforeDragLayer.draw();this.drag.draw();this.dragEdges.draw()};c.prototype.dragEnd=function(h){h.shape.moveTo(this.__beforeDragLayer);h.shape.draggable(false);for(var g=0;g<this.nodes.length;g++){this.nodes[g].listen(true)}for(var f in h.edges){var j=~~(Math.random()*this.edges.length);h.edges[f].shape.moveTo(this.edges[j]);this.edges[j].draw()}this.__beforeDragLayer.draw();this.drag.draw();this.dragEdges.draw()};function b(f){GS.Context.call(this,f);this.stage=new Kinetic.Stage({container:this.container,width:$(this.container).width(),height:$(this.container).height()});this.layers=new c(this.stage)}b.prototype={createNode:function(f,g){var h=new e(f,g);this.layers.addNode(h);return h},removeNode:function(g,f){this.layers.removeNode(f)},createEdge:function(h,k,g,j,f){var i=new d(h,k,g,j,f);this.layers.addEdge(i);return i},removeEdge:function(g,f){this.layers.removeEdge(f)},clear:function(f){}};a.GS.extend(GS.Context.prototype,b.prototype);setInterval(function(){for(var f=0;f<c.prototype.layers.length;f++){c.prototype.layers[f].drawAll()}},25);a.GS.registerContext("canvas",b)}(this));(function(a){function c(d){this.graph=d;this.nodes=[];this.links=[];this.graph.addSink(this);for(var e in this.graph.nodes){this.registerNode(e)}for(var e in this.graph.edges){this.registerEdge(e)}}c.prototype={start:function(){},reload:function(){},stop:function(){},registerNode:function(e){var d=this.graph.nodes[e];d.layoutIndex=this.nodes.length;this.nodes.push({id:e})},unregisterNode:function(e){var d=this.graph.nodes[e];this.nodes.splice(d.layoutIndex,1)},registerEdge:function(f){var d=this.graph.edges[f];d.layoutIndex=this.links.length;this.links.push({id:f,source:this.nodes[d.source.layoutIndex],target:this.nodes[d.target.layoutIndex],value:1})},unregisterEdge:function(f){var d=this.graph.edges[f];this.links.splice(d.layoutIndex,1)},nodeAdded:function(e,d,f){this.registerNode(f);this.reload()},nodeRemoved:function(e,d,f){this.unregisterNode(f);this.reload()},edgeAdded:function(g,e,i,f,h,d){this.registerEdge(i);this.reload()},edgeRemoved:function(e,d,f){this.unregisterEdge(f);this.reload()},graphCleared:function(e,d){this.nodes=[];this.links=[];this.reload()},pushXY:function(){for(var d=0;d<this.nodes.length;d++){this.graph.setXY(this.nodes[d].id,this.nodes[d].x,this.nodes[d].y)}},nodeAttributeAdded:function(g,d,h,f,e){},nodeAttributeChanged:function(g,e,i,f,d,h){},nodeAttributeRemoved:function(f,d,g,e){},edgeAttributeAdded:function(g,d,h,f,e){},edgeAttributeChanged:function(g,e,i,f,d,h){},edgeAttributeRemoved:function(f,d,g,e){},graphAttributeAdded:function(g,d,f,e){},graphAttributeChanged:function(g,e,f,d,h){},graphAttributeRemoved:function(f,d,e){},stepBegins:function(f,e,d){}};GS.extend(GS.Sink.prototype,c.prototype);function b(e){c.call(this,e);this.layout_running=false;this.layout=d3.layout.force().gravity(0).charge(-15).linkDistance(30);var d=this;this.layout.on("tick",function(){d.pushXY()})}b.prototype={start:function(){this.layout_running=true;this.reload()},reload:function(){if(this.layout_running){this.layout.stop()}this.layout.nodes(this.nodes).links(this.links);if(this.layout_running){this.layout.start()}},stop:function(){this.layout_running=false;this.layout.stop()}};GS.extend(c.prototype,b.prototype);a.GS.Layout=c;a.GS.ForceLayout=b}(this));(function(a){a.GS.prototype.dgs=function(c){var d=new b(this);d3.text(c,function(e){d.setData(e);d.parse()})};function b(c){this.graph=c;this.lines=[];this.line=""}b.prototype.setData=function(f){var e,c;this.lines=f.split("\n").reverse();c=this.lines.pop();e=/^DGS00\d$/;if(!e.test(c)){throw new Error("invalid dgs header '"+c+"'")}c=this.lines.pop();e=/^\S+ \d+ \d+$/;if(!e.test(c)){throw new Error("invalid dgs header '"+c+"'")}var d=0;while(d<this.lines.length){if(this.lines[d]===""||this.lines[d].charAt(0)==="#"){this.lines.splice(d,1)}else{d++}}};b.prototype.ready=function(){return(this.lines.length>0)};b.prototype.next=function(){this.line=this.lines.pop();return this};b.prototype.dir=function(){var c=this.line.substr(0,2).toLowerCase();this.line=this.line.substr(3,this.line.length-3);return c};b.prototype.parse=function(){var c;while(this.ready()){this.next();c=this.dir();switch(c){case"an":var f=this.nextId();this.graph.an(f);this.parseAttributes("node",f);break;case"cn":var f=this.nextId();this.parseAttributes("node",this.graph.sn(f));break;case"dn":var f=nextId();this.graph.dn(f);break;case"ae":var f=this.nextId(),d=this.nextId(),e=this.nextId();this.graph.ae(f,d,e);break;case"ce":var f=this.nextId();this.parseAttributes("edge",this.graph.se(f));break;case"de":var f=this.nextId();this.graph.de(f);this.parseAttributes("edge",f);break;case"cg":break;case"st":break;case"cl":this.graph.cl();break;default:throw new Error("unknown directive '"+c+"'")}}};b.prototype.nextId=function(){var e=/^(?:'([^'])*'|"([^"])"|([\w\d]+))(?: (.*))?$/;var d=e.exec(this.line);var c=0;if(d[++c]!==undefined||d[++c]!==undefined||d[++c]!==undefined){this.line=d[4];return d[c]}else{return undefined}};b.prototype.parseAttributes=function(f,g,c){var d=/[+-]?("[^"]*"|'[^']*'|\w[[\w.]*)([:=](\d+([.]\d+)?|\w[[\w.]*|"[^"]*"|'[^']*'|#[a-fA-F0-9]{6}))?/g;switch(f){case"node":break;case"edge":break}}})(window);